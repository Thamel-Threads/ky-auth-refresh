'use strict';Object.defineProperty(exports,'__esModule',{value:true});var p={statusCodes:[401],pauseInstanceWhileRefreshing:false};function a(e,t){return {...e,...t}}function y(e,t,s,r){return !e||e.request?.skipAuthRefresh||!(t.interceptNetworkError&&!e.response&&e.request?.status===0)&&(!e.response||(t?.shouldRefresh?!t.shouldRefresh(e):!t.statusCodes?.includes(parseInt(e.response.status))))?false:(e.response||(e.response={request:e.request}),!t.pauseInstanceWhileRefreshing||!r.skipInstances.includes(s))}function c(e,t,s){return !s.refreshCall&&(s.refreshCall=t(e),typeof s.refreshCall.then!="function")?(console.warn("@thamel-threads/ky-auth-refresh requires `refreshTokenCall` to return a promise."),Promise.reject(new Error("refreshTokenCall must return a promise"))):s.refreshCall}function l(e,t,s){return typeof t.requestQueueInterceptorId>"u"&&(t.requestQueueInterceptorId=Math.random()),t.requestQueueInterceptorId}function R(e,t){t.requestQueueInterceptorId=void 0,t.refreshCall=void 0,t.skipInstances=t.skipInstances.filter(s=>s!==e);}function d(e,t){return t.retryInstance||e}function I(e,t){let s={skipAuthRefresh:true},r=e.response.request.url,u={method:e.response.request.method,headers:e.response.request.headers,body:e.response.request.body,...s};return t(r,u)}function C(e,t,s={}){if(typeof t!="function")throw new Error("@thamel-threads/ky-auth-refresh requires `refreshAuthCall` to be a function that returns a promise.");let r={skipInstances:[],refreshCall:void 0,requestQueueInterceptorId:void 0},u=a(p,s),m=async(i,f,n)=>{let o=a(u,f);if(f?.skipAuthRefresh||n.ok)return n;let h={response:{status:n.status,request:i},request:i,options:f};if(!y(h,o,e,r))return n;o.pauseInstanceWhileRefreshing&&r.skipInstances.push(e);let K=c(h,t,r);l(e,r);try{await K;let A=d(e,o);return await I(h,A)}catch{return n}finally{R(e,r);}};return e.extend({hooks:{afterResponse:[m]}})}var x=C;exports.createAuthRefreshHook=C;exports.default=x;//# sourceMappingURL=index.cjs.map
//# sourceMappingURL=index.cjs.map